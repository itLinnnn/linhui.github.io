<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#34495e">
  <title>vue组件间的通信 | 林晖的个人博客</title>
  <link rel="alternate" href="path/of/rss" type="application/atom+xml">
  <link rel="shortcut icon" type="image/ico" href="/favicon.ico">
  <link rel="stylesheet" href="/linhui.github.io/css/style.css">
  

  

  

  

</head>

<body>
  <div class="mobile-header">
    <span><i class="iconfont icon-turnon" id="mobile-nav-toggle"></i></span>
    <div class="mobile-logo">
      <a href="/linhui.github.io/.">Ztopic</a>
    </div>
  </div>
  <div class="page" id="mobile-nav-panel">
    <div class="container">
      <header class="site-nav">
      <div class="nav-content">
        <div class="logo">
          <a href="/linhui.github.io/">Ztopic</a>
        </div>
        <nav class="navbar">
          <ul>
            
              <li class="menu-item">
                <a href="/linhui.github.io/" class="menu-item-link"><i class="iconfont icon-home"></i>首页</a>
              </li>
            
              <li class="menu-item">
                <a href="/linhui.github.io/archives" class="menu-item-link"><i class="iconfont icon-archive"></i>归档</a>
              </li>
            
              <li class="menu-item">
                <a href="/linhui.github.io/about" class="menu-item-link"><i class="iconfont icon-about"></i>关于</a>
              </li>
            
          </ul>
        </nav>
      </div>
</header>

      <div class="banner">
  <div class="show">
    <!-- <img src="/linhui.github.io/" alt="banner"> -->
    <div class="banner-title">
      
        <div class="post-title">
          vue组件间的通信
            <div class="post-tags">
    		    
    	      </div>
        </div>
      
    </div>
  </div>
</div>

      <main class="main"id="main">
          <article class="post">
  

  <header>
    <div class="post-title mobile-post-title">
      <h1>vue组件间的通信</h1>
        <div class="post-tags">
        
        </div>
    </div>
    <div class="post-meta">
      <span class="post-time"><i class="iconfont icon-calendar"></i>2018-04-07</span>
      
      <!----------------------------------->
        
      <!----------------------------------->
    </div>
  </header>
  
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#组件间的数据传递"><span class="toc-text">组件间的数据传递</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-父组件-—-gt-子组件（prop）"><span class="toc-text">1.父组件 —-&gt; 子组件（prop）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-Prop传递数据"><span class="toc-text">使用 Prop传递数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态-Prop"><span class="toc-text">动态 Prop</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#单向数据流（数据传递过程中需要解决的问题）"><span class="toc-text">单向数据流（数据传递过程中需要解决的问题）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-子组件-—-gt-父组件（绑定自定义事件）"><span class="toc-text">2.子组件 —-&gt; 父组件（绑定自定义事件）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义事件"><span class="toc-text">自定义事件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-非父子组件的数据传递-（bus总线）"><span class="toc-text">3.非父子组件的数据传递 （bus总线）</span></a></li></ol>
    </div>
  </div>


  <div class="post-content">
    <h2 id="组件间的数据传递"><a href="#组件间的数据传递" class="headerlink" title="组件间的数据传递"></a>组件间的数据传递</h2><hr>
<p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;由于组件实例的作用域是单独的。所以就不能在一个组件中直接引用另一个组件中的数据，但是在一个项目中数据的处理往往是很频繁的，并且组件设计初衷就是要配合使用的，通过组件间的关联，来更加高效的处理一些问题。所以，简单的介绍一下组件组合后组件间互相通信的方式</p>
<h2 id="1-父组件-—-gt-子组件（prop）"><a href="#1-父组件-—-gt-子组件（prop）" class="headerlink" title="1.父组件 —-&gt; 子组件（prop）"></a>1.父组件 —-&gt; 子组件（prop）</h2><h3 id="使用-Prop传递数据"><a href="#使用-Prop传递数据" class="headerlink" title="使用 Prop传递数据"></a>使用 Prop传递数据</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;组件的孤立作用域，使得子组件的模板内不能直接引用父组件的数据，在这里可以通过prop进行下发,例如：</p>
<pre><code>
var child = {
  // 声明 props
  props: ['message'],
  // 就像 data 一样，prop 也可以在模板中使用
  template: '< div>{{message}}我是一个子组件!< /div>'
}
export default {
   components: {
    'children-componment': child
  },
  data () {
    return {
      msg: 'Welcome to Your Vue.js App'
    }
  }
}
</code></pre>

<p>然后通过向组件传入一个字符串：</p>
<pre><code>
 < children-componment message="hello" >< /children-componment>
</code></pre>

<p>在此处子组件 children-componment显式地用 props 选项声明预期的数据，在使用时又传入字符串，则可将数据下发到子组件中</p>
<h3 id="动态-Prop"><a href="#动态-Prop" class="headerlink" title="动态 Prop"></a>动态 Prop</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;往往我们需要子组件来实时的跟踪父组件的数据变化，以做及时的关联处理。此时可以用 v-bind 来动态地将 prop 绑定到父组件的数据。所以每当父组件的数据变化时，该变化也会传导给子组件，可以跟着一起变化：</p>
<pre><code>
< template>
  < div class="hello">
    < h1>{{ msg }}
     < input v-model = "parentMsg">
     < br>
     < children-componment :my-message="parentMsg" >< /children-componment>
  < /div>
< /template>
var child = {
  // 声明 props
  props: ['myMessage'],
  // 就像 data 一样，prop 也可以在模板中使用
  template: '< div> {{myMessage}} 我是一个子组件!< /div>'
}
export default {
   components: {
    'children-componment': child
  },
  data () {
    return {
      msg: 'Welcome to Your Vue.js App',
      parentMsg: 'Message from parent'
    }
  }
}
</code></pre>

<p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;此时的输入框input是存在于父组件，通过v-model绑定parentMsg,并且将值传递给子组件&lt; children-componment&gt;&lt; /children-componment&gt;，此时的子组件接收的值也是随着父组件的变化而动态改变的。</p>
<h4 id="单向数据流（数据传递过程中需要解决的问题）"><a href="#单向数据流（数据传递过程中需要解决的问题）" class="headerlink" title="单向数据流（数据传递过程中需要解决的问题）"></a>单向数据流（数据传递过程中需要解决的问题）</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Prop 可以实现从父组件到子组件的数据传递，但是同时也要注意，prop是单向绑定的。这也就是意味着当父组件的属性变化时，将传导给子组件，但是当子组件发生改变时却不会反馈给父组件。这是为了防止子组件无意间修改了父组件的状态，来避免应用的数据流变得难以理解。<br>另外，每次父组件更新时，子组件的所有 prop 都会更新为最新值。所以存在着两个容易出错的场景：</p>
<ul>
<li>Prop 作为初始值传入后，子组件想把它当作局部数据来用</li>
</ul>
<p>解决方法 (定义一个局部变量，并用 prop 的值初始化这个局部变量：)：</p>
<pre><code>
  props: ['myMessage'],
  // 就像 data 一样，prop 也可以在模板中使用
  template: '< div> {{variable}} 我是一个子组件!< /div>',
   data: function () {
    return { 
      variable: this.myMessage
    }
  }
</code></pre>

<ul>
<li>Prop 作为原始数据传入，由子组件处理成其它数据输出</li>
</ul>
<pre><code>
props: ['param'],
computed: {
//handleParam为处理过可使用的数据
  handleParam: function () {
    return this.param+5
  }
}
</code></pre>

<p>！！！注：不能在子组件内部改变 prop</p>
<h2 id="2-子组件-—-gt-父组件（绑定自定义事件）"><a href="#2-子组件-—-gt-父组件（绑定自定义事件）" class="headerlink" title="2.子组件 —-&gt; 父组件（绑定自定义事件）"></a>2.子组件 —-&gt; 父组件（绑定自定义事件）</h2><h4 id="自定义事件"><a href="#自定义事件" class="headerlink" title="自定义事件"></a>自定义事件</h4><p>子组件向父组件传递数据使用Vue 的自定义事件系统实现，每个 Vue 实例实现的事件接口：</p>
<ul>
<li><p>使用 $on(eventName) 监听事件</p>
</li>
<li><p>使用 $emit(eventName, optionalPayload) 触发事件</p>
</li>
</ul>
<pre><code>
//此处跟着官方文档的例子来梳理一遍
< template>
 < div>
   < h1>{{total}}< /h1>
   //3.组件监听到'increment'事件，并且执行'incrementTotal'方法，改变父组件中的total的值
   < children-componment v-on:increment="incrementTotal">+< /children-componment>
   < children-componment v-on:increment="incrementTotal">+< /children-componment>
  < /div>
  < /template>
</code></pre>

<pre><code>
var child = {
//1.当子组件的按钮按下时执行incrementCounter方法
  template: '< button v-on:click="incrementCounter">子组件{{ counter }}< /button>',
  data: function () {
      return {
          counter: 0
      }
  },
  methods: {
    2.执行方法，将counter的值加1，并且触发了一个'increment'的事件
    incrementCounter: function () {
      this.counter += 1
      this.$emit('increment')
    },
  }
}
export default {
  data: function () {
    return {
      total: 0
    }
  },
  methods: {    
    incrementTotal: function () {
      this.total += 1
    }
  },
  components: {
    'children-componment': child
  },
}
</code></pre>
子组件件向父组件传递数据的过程如上注释所标的序号所示：<br>

* 1.当子组件的按钮按下时执行incrementCounter方法

* 2.执行incrementCounter方法，将counter的值加1，并且触发了一个'increment'的事件 

* 3.组件监听到'increment'事件，并且执行'incrementTotal'方法，改变父组件中的total的值

#### 如何使用载荷 (payload) 数据，就在刚刚的例子中稍加修改：

<pre><code>
var child = {
  template: '< button v-on:click="incrementCounter">子组件{{ counter }}< /button>',
  data: function () {
      return {
          counter: 0
      }
  },
  methods: {
    incrementCounter: function () {
      this.counter += 1
      this.$emit('increment',{number:3})
    },
  }
}
</code></pre>

<pre><code>
data: function () {
    return {
      total: 0
    }
  },
  methods: {    
    incrementTotal: function (payload) {
      this.total += payload.number
    }
  },
  components: {
    'children-componment': child
  },
</code></pre>

<p>此时点击一次按钮时，total就是加3，3即为传过来的payload的数据</p>
<h2 id="3-非父子组件的数据传递-（bus总线）"><a href="#3-非父子组件的数据传递-（bus总线）" class="headerlink" title="3.非父子组件的数据传递 （bus总线）"></a>3.非父子组件的数据传递 （bus总线）</h2><p>非父子组件之间也需要有数据的传递，此时可以使用空的vue实例bus总线</p>
<pre><code>
// 触发组件 A 中的事件
bus.$emit('selected')
// 在组件 B 中监听事件
bus.$on('selected', function () {
  // ...
})
</code></pre>

<p>简单的数据交互可以使用bus总线的方法，但是在较为复杂的情境下<br>，会使用vuex状态管理来实现。这个会在后续的学习中进一步深入了解，并作分享。</p>

  </div>
  <div class="post-footer">the end</div>
</article>

          
  <nav class="pagination post-nav">
    
      <a href="/linhui.github.io/Vue的内容分发slot的使用/">
        <span class="prev-post"><i class="iconfont icon-back"></i>Vue的内容分发slot的使用</span>
      </a>
    
    
      <a href="/linhui.github.io/Vue的组件的概念与基本使用/">
        <span class="next-post">Vue的组件的概念与基本使用<i class="iconfont icon-more"></i></span>
      </a>
    
  </nav>


          
  


      </main>
    </div>
    <footer>
      <div class="social-links">
        
          
            <a href="https://www.zhihu.com/"><i class="iconfont icon-zhihu"></i></a>
          
        
          
            <a href="https://weibo.com"><i class="iconfont icon-weibo"></i></a>
          
        
          
            <a href="https://github.com/"><i class="iconfont icon-github"></i></a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
      
        <div class="quote">
          <p>Love all, trust a few, do wrong to none.——William Shakespeare</p>
        </div>
      
      <div class="copyright">
        <p>
          由 <a href="https://hexo.io/">Hexo</a> 强力驱动
          <span>|</span>
          主题 - <a href="https://github.com/wa-ri/hexo-theme-ztopic">ztopic</a
        </p>
        <p>
          <span>
          
          &copy;
          
            2018
          
          </span>
          <i class="iconfont icon-circle"></i>
          <span>林晖</span>
        </p>
      </div>
</footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <div id="mobile-nav">
  <nav id="mobile-nav-menu">
    
      <a href="/linhui.github.io/" class="mobile-nav-link"><i class="iconfont icon-home"></i>首页</a>
    
      <a href="/linhui.github.io/archives" class="mobile-nav-link"><i class="iconfont icon-archive"></i>归档</a>
    
      <a href="/linhui.github.io/about" class="mobile-nav-link"><i class="iconfont icon-about"></i>关于</a>
    
    <div class="mobile-intro"><i class="iconfont icon-pen"></i>practice makes perfect</div>
  </nav>
</div>


  <script src="/linhui.github.io/libs/jQuery/jquery-3.2.1.min.js"></script>
  <script src="/linhui.github.io/libs/slideout/slideout.min.js"></script>
  
    <link rel="stylesheet" href="/linhui.github.io/libs/fancybox/jquery.fancybox.css">
    <script src="/linhui.github.io/libs/fancybox/jquery.fancybox.pack.js"></script>
  
  

  <script src="/linhui.github.io/js/ztopic.js"></script>
</body>
</html>
