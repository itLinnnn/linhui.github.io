<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>vue组件间的通信 | 林晖的个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="组件间的数据传递  &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;由于组件实例的作用域是单独的。所以就不能在一个组件中直接引用另一个组件中的数据，但是在一个项目中数据的处理往往是很频繁的，并且组件设计初衷就是要配合使用的，通过组件间的关联，来更加高效的处理一些问题。所以，简单的介绍一下组件组合后组件间互相通信的方式 1.父组件 —-&amp;gt; 子组件（prop）">
<meta property="og:type" content="article">
<meta property="og:title" content="vue组件间的通信">
<meta property="og:url" content="https://itlinnnn.github.io/linhui.github.io/2018/04/07/vue组件间的通信/index.html">
<meta property="og:site_name" content="林晖的个人博客">
<meta property="og:description" content="组件间的数据传递  &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;由于组件实例的作用域是单独的。所以就不能在一个组件中直接引用另一个组件中的数据，但是在一个项目中数据的处理往往是很频繁的，并且组件设计初衷就是要配合使用的，通过组件间的关联，来更加高效的处理一些问题。所以，简单的介绍一下组件组合后组件间互相通信的方式 1.父组件 —-&amp;gt; 子组件（prop）">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-04-14T16:48:55.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="vue组件间的通信">
<meta name="twitter:description" content="组件间的数据传递  &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;由于组件实例的作用域是单独的。所以就不能在一个组件中直接引用另一个组件中的数据，但是在一个项目中数据的处理往往是很频繁的，并且组件设计初衷就是要配合使用的，通过组件间的关联，来更加高效的处理一些问题。所以，简单的介绍一下组件组合后组件间互相通信的方式 1.父组件 —-&amp;gt; 子组件（prop）">
  
    <link rel="alternate" href="/linhui.github.io/atom.xml" title="林晖的个人博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/linhui.github.io/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/linhui.github.io/" id="logo">林晖的个人博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/linhui.github.io/">主页</a>
        
          <a class="main-nav-link" href="/linhui.github.io/archives">博客</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/linhui.github.io/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://itlinnnn.github.io/linhui.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-vue组件间的通信" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/linhui.github.io/2018/04/07/vue组件间的通信/" class="article-date">
  <time datetime="2018-04-07T15:21:28.000Z" itemprop="datePublished">2018-04-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      vue组件间的通信
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="组件间的数据传递"><a href="#组件间的数据传递" class="headerlink" title="组件间的数据传递"></a>组件间的数据传递</h2><hr>
<p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;由于组件实例的作用域是单独的。所以就不能在一个组件中直接引用另一个组件中的数据，但是在一个项目中数据的处理往往是很频繁的，并且组件设计初衷就是要配合使用的，通过组件间的关联，来更加高效的处理一些问题。所以，简单的介绍一下组件组合后组件间互相通信的方式</p>
<h2 id="1-父组件-—-gt-子组件（prop）"><a href="#1-父组件-—-gt-子组件（prop）" class="headerlink" title="1.父组件 —-&gt; 子组件（prop）"></a>1.父组件 —-&gt; 子组件（prop）</h2><h3 id="使用-Prop传递数据"><a href="#使用-Prop传递数据" class="headerlink" title="使用 Prop传递数据"></a>使用 Prop传递数据</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;组件的孤立作用域，使得子组件的模板内不能直接引用父组件的数据，在这里可以通过prop进行下发,例如：</p>
<pre><code>
var child = {
  // 声明 props
  props: ['message'],
  // 就像 data 一样，prop 也可以在模板中使用
  template: '< div>{{message}}我是一个子组件!< /div>'
}
export default {
   components: {
    'children-componment': child
  },
  data () {
    return {
      msg: 'Welcome to Your Vue.js App'
    }
  }
}
</code></pre>

<p>然后通过向组件传入一个字符串：</p>
<pre><code>
 < children-componment message="hello" >< /children-componment>
</code></pre>

<p>在此处子组件 children-componment显式地用 props 选项声明预期的数据，在使用时又传入字符串，则可将数据下发到子组件中</p>
<h3 id="动态-Prop"><a href="#动态-Prop" class="headerlink" title="动态 Prop"></a>动态 Prop</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;往往我们需要子组件来实时的跟踪父组件的数据变化，以做及时的关联处理。此时可以用 v-bind 来动态地将 prop 绑定到父组件的数据。所以每当父组件的数据变化时，该变化也会传导给子组件，可以跟着一起变化：</p>
<pre><code>
< template>
  < div class="hello">
    < h1>{{ msg }}
     < input v-model = "parentMsg">
     < br>
     < children-componment :my-message="parentMsg" >< /children-componment>
  < /div>
< /template>
var child = {
  // 声明 props
  props: ['myMessage'],
  // 就像 data 一样，prop 也可以在模板中使用
  template: '< div> {{myMessage}} 我是一个子组件!< /div>'
}
export default {
   components: {
    'children-componment': child
  },
  data () {
    return {
      msg: 'Welcome to Your Vue.js App',
      parentMsg: 'Message from parent'
    }
  }
}
</code></pre>

<p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;此时的输入框input是存在于父组件，通过v-model绑定parentMsg,并且将值传递给子组件&lt; children-componment&gt;&lt; /children-componment&gt;，此时的子组件接收的值也是随着父组件的变化而动态改变的。</p>
<h4 id="单向数据流（数据传递过程中需要解决的问题）"><a href="#单向数据流（数据传递过程中需要解决的问题）" class="headerlink" title="单向数据流（数据传递过程中需要解决的问题）"></a>单向数据流（数据传递过程中需要解决的问题）</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Prop 可以实现从父组件到子组件的数据传递，但是同时也要注意，prop是单向绑定的。这也就是意味着当父组件的属性变化时，将传导给子组件，但是当子组件发生改变时却不会反馈给父组件。这是为了防止子组件无意间修改了父组件的状态，来避免应用的数据流变得难以理解。<br>另外，每次父组件更新时，子组件的所有 prop 都会更新为最新值。所以存在着两个容易出错的场景：</p>
<ul>
<li>Prop 作为初始值传入后，子组件想把它当作局部数据来用</li>
</ul>
<p>解决方法 (定义一个局部变量，并用 prop 的值初始化这个局部变量：)：</p>
<pre><code>
  props: ['myMessage'],
  // 就像 data 一样，prop 也可以在模板中使用
  template: '< div> {{variable}} 我是一个子组件!< /div>',
   data: function () {
    return { 
      variable: this.myMessage
    }
  }
</code></pre>

<ul>
<li>Prop 作为原始数据传入，由子组件处理成其它数据输出</li>
</ul>
<pre><code>
props: ['param'],
computed: {
//handleParam为处理过可使用的数据
  handleParam: function () {
    return this.param+5
  }
}
</code></pre>

<p>！！！注：不能在子组件内部改变 prop</p>
<h2 id="2-子组件-—-gt-父组件（绑定自定义事件）"><a href="#2-子组件-—-gt-父组件（绑定自定义事件）" class="headerlink" title="2.子组件 —-&gt; 父组件（绑定自定义事件）"></a>2.子组件 —-&gt; 父组件（绑定自定义事件）</h2><h4 id="自定义事件"><a href="#自定义事件" class="headerlink" title="自定义事件"></a>自定义事件</h4><p>子组件向父组件传递数据使用Vue 的自定义事件系统实现，每个 Vue 实例实现的事件接口：</p>
<ul>
<li><p>使用 $on(eventName) 监听事件</p>
</li>
<li><p>使用 $emit(eventName, optionalPayload) 触发事件</p>
</li>
</ul>
<pre><code>
//此处跟着官方文档的例子来梳理一遍
< template>
 < div>
   < h1>{{total}}< /h1>
   //3.组件监听到'increment'事件，并且执行'incrementTotal'方法，改变父组件中的total的值
   < children-componment v-on:increment="incrementTotal">+< /children-componment>
   < children-componment v-on:increment="incrementTotal">+< /children-componment>
  < /div>
  < /template>
</code></pre>

<pre><code>
var child = {
//1.当子组件的按钮按下时执行incrementCounter方法
  template: '< button v-on:click="incrementCounter">子组件{{ counter }}< /button>',
  data: function () {
      return {
          counter: 0
      }
  },
  methods: {
    2.执行方法，将counter的值加1，并且触发了一个'increment'的事件
    incrementCounter: function () {
      this.counter += 1
      this.$emit('increment')
    },
  }
}
export default {
  data: function () {
    return {
      total: 0
    }
  },
  methods: {    
    incrementTotal: function () {
      this.total += 1
    }
  },
  components: {
    'children-componment': child
  },
}
</code></pre>
子组件件向父组件传递数据的过程如上注释所标的序号所示：<br>

* 1.当子组件的按钮按下时执行incrementCounter方法

* 2.执行incrementCounter方法，将counter的值加1，并且触发了一个'increment'的事件 

* 3.组件监听到'increment'事件，并且执行'incrementTotal'方法，改变父组件中的total的值

#### 如何使用载荷 (payload) 数据，就在刚刚的例子中稍加修改：

<pre><code>
var child = {
  template: '< button v-on:click="incrementCounter">子组件{{ counter }}< /button>',
  data: function () {
      return {
          counter: 0
      }
  },
  methods: {
    incrementCounter: function () {
      this.counter += 1
      this.$emit('increment',{number:3})
    },
  }
}
</code></pre>

<pre><code>
data: function () {
    return {
      total: 0
    }
  },
  methods: {    
    incrementTotal: function (payload) {
      this.total += payload.number
    }
  },
  components: {
    'children-componment': child
  },
</code></pre>

<p>此时点击一次按钮时，total就是加3，3即为传过来的payload的数据</p>
<h2 id="3-非父子组件的数据传递-（bus总线）"><a href="#3-非父子组件的数据传递-（bus总线）" class="headerlink" title="3.非父子组件的数据传递 （bus总线）"></a>3.非父子组件的数据传递 （bus总线）</h2><p>非父子组件之间也需要有数据的传递，此时可以使用空的vue实例bus总线</p>
<pre><code>
// 触发组件 A 中的事件
bus.$emit('selected')
// 在组件 B 中监听事件
bus.$on('selected', function () {
  // ...
})
</code></pre>

<p>简单的数据交互可以使用bus总线的方法，但是在较为复杂的情境下<br>，会使用vuex状态管理来实现。这个会在后续的学习中进一步深入了解，并作分享。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://itlinnnn.github.io/linhui.github.io/2018/04/07/vue组件间的通信/" data-id="cjfzklkut0003vixervxpiqi0" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/linhui.github.io/2018/04/14/Vue的内容分发slot的使用/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Vue的内容分发slot的使用
        
      </div>
    </a>
  
  
    <a href="/linhui.github.io/2018/04/07/Vue的组件的概念与基本使用/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Vue的组件的概念与基本使用</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/linhui.github.io/archives/2018/04/">April 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/linhui.github.io/2018/04/14/Vue-js可复用性/">Vue.js可复用性</a>
          </li>
        
          <li>
            <a href="/linhui.github.io/2018/04/14/Vue的内容分发slot的使用/">Vue的内容分发slot的使用</a>
          </li>
        
          <li>
            <a href="/linhui.github.io/2018/04/07/vue组件间的通信/">vue组件间的通信</a>
          </li>
        
          <li>
            <a href="/linhui.github.io/2018/04/07/Vue的组件的概念与基本使用/">Vue的组件的概念与基本使用</a>
          </li>
        
          <li>
            <a href="/linhui.github.io/2018/04/07/时间、时间戳、带格式时间的转换/">时间、时间戳、带格式时间的转换</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 林晖<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/linhui.github.io/" class="mobile-nav-link">主页</a>
  
    <a href="/linhui.github.io/archives" class="mobile-nav-link">博客</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/linhui.github.io/fancybox/jquery.fancybox.css">
  <script src="/linhui.github.io/fancybox/jquery.fancybox.pack.js"></script>


<script src="/linhui.github.io/js/script.js"></script>



  </div>
</body>
</html>